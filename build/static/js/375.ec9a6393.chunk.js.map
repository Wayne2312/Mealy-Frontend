{"version":3,"file":"static/js/375.ec9a6393.chunk.js","mappings":"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","sources":["MpesaPaymentForm.jsx","PaymentStatus.jsx","CheckoutPage.jsx","usePaymentStatus.jsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst MpesaPaymentForm = ({ orderId, amount, onPaymentSuccess }) => {\r\n  const [phone, setPhone] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [paymentInitiated, setPaymentInitiated] = useState(false);\r\n\r\n  const formatPhoneNumber = (phone) => {\r\n    const cleaned = phone.replace(/\\D/g, '');\r\n    if (cleaned.startsWith('0')) {\r\n      return '254' + cleaned.substring(1);\r\n    }\r\n    if (cleaned.startsWith('7') && cleaned.length === 9) {\r\n      return '254' + cleaned;\r\n    }\r\n    return cleaned;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    setError(null);\r\n    const formattedPhone = formatPhoneNumber(phone);\r\n    if (formattedPhone.length !== 12 || !formattedPhone.startsWith('2547')) {\r\n       setError('Please enter a valid Kenyan M-Pesa phone number (e.g., 0712345678).');\r\n       setLoading(false);\r\n       return;\r\n    }\r\n\r\n    try {\r\n      const response = await axios.post(\r\n        `${process.env.REACT_APP_BACKEND_URL}/api/mpesa-payment/`,\r\n        {\r\n          order_id: orderId,\r\n          phone: formattedPhone,\r\n          amount: amount\r\n        },\r\n        {\r\n          headers: {\r\n            'Authorization': `Bearer ${localStorage.getItem('access_token')}`,\r\n            'Content-Type': 'application/json'\r\n          }\r\n        }\r\n      );\r\n      if (response.data.success) {\r\n        setPaymentInitiated(true);\r\n      } else {\r\n        setError(response.data.error || 'Payment initiation failed. Please try again.');\r\n      }\r\n    } catch (err) {\r\n      console.error(\"M-Pesa Payment Error:\", err);\r\n      setError(err.response?.data?.error || 'Failed to initiate payment. Please check your network and try again.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\r\n      <h3 className=\"text-xl font-semibold text-gray-800 mb-4\">M-Pesa Payment</h3>\r\n      <div className=\"mb-6 p-4 bg-orange-50 rounded-md border border-orange-100\">\r\n        <p className=\"text-lg font-medium text-orange-800\">Amount: <span className=\"font-bold\">KSh {parseFloat(amount).toFixed(2)}</span></p>\r\n        <p className=\"text-sm text-orange-600 mt-1\">Please ensure your phone number is registered with M-Pesa.</p>\r\n      </div>\r\n\r\n      {paymentInitiated ? (\r\n        <div className=\"text-center py-6\">\r\n          <div className=\"mb-4\">\r\n            <div className=\"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-3\">\r\n              <span className=\"text-orange-500 text-2xl\">📱</span>\r\n            </div>\r\n            <h4 className=\"text-lg font-medium text-gray-900\">Payment Initiated</h4>\r\n          </div>\r\n          <div className=\"space-y-2 text-gray-600\">\r\n            <p className=\"flex items-center justify-center\">\r\n              <svg className=\"h-5 w-5 text-orange-500 mr-2\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Check your phone for an M-Pesa prompt.\r\n            </p>\r\n            <p className=\"flex items-center justify-center\">\r\n              <svg className=\"h-5 w-5 text-orange-500 mr-2\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\r\n              </svg>\r\n              Enter your M-Pesa PIN to complete payment.\r\n            </p>\r\n          </div>\r\n          <div className=\"mt-4 text-sm text-gray-500 italic\">\r\n            This page will update automatically once payment is confirmed.\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n          <div>\r\n            <label htmlFor=\"mpesa-phone\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n              M-Pesa Phone Number\r\n            </label>\r\n            <input\r\n              id=\"mpesa-phone\"\r\n              type=\"tel\"\r\n              value={phone}\r\n              onChange={(e) => setPhone(e.target.value)}\r\n              placeholder=\"e.g. 0712345678 or 254712345678\"\r\n              required\r\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500\"\r\n            />\r\n            <p className=\"mt-1 text-xs text-gray-500\">Must be registered with M-Pesa.</p>\r\n          </div>\r\n\r\n          {error && (\r\n            <div className=\"rounded-md bg-red-50 p-4 border border-red-200\">\r\n              <div className=\"flex\">\r\n                <div className=\"flex-shrink-0\">\r\n                  <svg className=\"h-5 w-5 text-red-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n                    <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n                  </svg>\r\n                </div>\r\n                <div className=\"ml-3\">\r\n                  <h3 className=\"text-sm font-medium text-red-800\">Payment Error</h3>\r\n                  <div className=\"mt-2 text-sm text-red-700\">\r\n                    <p>{error}</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <button\r\n            type=\"submit\"\r\n            disabled={loading}\r\n            className={`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${\r\n              loading\r\n                ? 'bg-orange-400 cursor-not-allowed'\r\n                : 'bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500'\r\n            }`}\r\n          >\r\n            {loading ? (\r\n              <>\r\n                <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                  <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                </svg>\r\n                Processing...\r\n              </>\r\n            ) : (\r\n              'Pay with M-Pesa'\r\n            )}\r\n          </button>\r\n        </form>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MpesaPaymentForm;","import React from 'react';\r\n\r\nconst PaymentStatus = ({ status, error }) => {\r\n  const statusMessages = {\r\n    pending: 'Waiting for payment confirmation...',\r\n    completed: 'Payment completed successfully!',\r\n    failed: error || 'Payment failed. Please try again.'\r\n  };\r\n\r\n  const statusClasses = {\r\n    pending: 'payment-status-pending',\r\n    completed: 'payment-status-completed',\r\n    failed: 'payment-status-failed'\r\n  };\r\n\r\n  return (\r\n    <div className={`payment-status ${statusClasses[status]}`}>\r\n      <div className=\"status-icon\">\r\n        {status === 'completed' ? '✓' : status === 'failed' ? '✗' : '⏳'}\r\n      </div>\r\n      <p>{statusMessages[status]}</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentStatus;","import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport MpesaPaymentForm from './MpesaPaymentForm';\r\nimport PaymentStatus from './PaymentStatus';\r\nimport usePaymentStatus from './usePaymentStatus';\r\n\r\nconst CheckoutPage = () => {\r\n  const { orderId } = useParams();\r\n  const navigate = useNavigate();\r\n  const [order, setOrder] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [paymentInitiated, setPaymentInitiated] = useState(false);\r\n  \r\n  const { status: paymentStatus } = usePaymentStatus(\r\n    orderId, \r\n    order?.payment_status || 'pending'\r\n  );\r\n\r\n  useEffect(() => {\r\n    const fetchOrder = async () => {\r\n      try {\r\n        const response = await axios.get(`${process.env.REACT_APP_BACKEND_URL}/api/orders/${orderId}/`);\r\n        setOrder(response.data);\r\n      } catch (err) {\r\n        console.error(\"Error fetching order:\", err);\r\n        setError('Failed to load order details. Please try again.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    if (orderId) {\r\n       fetchOrder();\r\n    } else {\r\n       setError('Invalid order ID.');\r\n       setLoading(false);\r\n    }\r\n  }, [orderId]);\r\n  useEffect(() => {\r\n    if (paymentStatus === 'completed') {\r\n      const timer = setTimeout(() => {\r\n        navigate('/customer-dashboard', { \r\n          state: { message: 'Payment completed successfully!' } \r\n        });\r\n      }, 3000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [paymentStatus, navigate]);\r\n\r\n  if (loading) return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <div className=\"flex justify-center items-center h-64\">\r\n        <div className=\"text-lg text-gray-600\">Loading order details...</div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (error) return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <div className=\"bg-red-50 border-l-4 border-red-500 p-4 rounded\">\r\n        <div className=\"flex\">\r\n          <div className=\"flex-shrink-0\">\r\n            <svg className=\"h-5 w-5 text-red-400\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\r\n            </svg>\r\n          </div>\r\n          <div className=\"ml-3\">\r\n            <p className=\"text-sm text-red-700\">\r\n              {error}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (!order) return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <div className=\"text-center py-12\">\r\n        <div className=\"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\r\n          <span className=\"text-gray-400 text-2xl\">❓</span>\r\n        </div>\r\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Order Not Found</h3>\r\n        <p className=\"text-gray-500\">We couldn't find the order details.</p>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n      <div className=\"mb-8\">\r\n        <h2 className=\"text-3xl font-bold text-gray-900\">Complete Your Payment</h2>\r\n        <p className=\"mt-2 text-gray-600\">Securely pay for your order using M-Pesa.</p>\r\n      </div>\r\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden max-w-3xl mx-auto\">\r\n        <div className=\"p-6 sm:p-8\">\r\n          <div className=\"mb-8 pb-6 border-b border-gray-200\">\r\n            <h3 className=\"text-xl font-semibold text-gray-800 mb-4\">Order Summary</h3>\r\n            <div className=\"flex justify-between items-center\">\r\n              <div>\r\n                <h4 className=\"text-lg font-medium text-gray-900\">Order #{order.id}</h4>\r\n                <p className=\"text-gray-600\">Meal: {order.meal_name}</p>\r\n                <p className=\"text-gray-600\">Quantity: {order.quantity}</p>\r\n              </div>\r\n              <div className=\"text-right\">\r\n                <div className=\"text-2xl font-bold text-orange-600\">KSh {parseFloat(order.total).toFixed(2)}</div>\r\n                <div className=\"mt-1\">\r\n                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${\r\n                    order.status === 'confirmed' \r\n                    ? 'bg-green-100 text-green-800'\r\n                    : order.status === 'pending'\r\n                    ? 'bg-yellow-100 text-yellow-800'\r\n                    : order.status === 'cancelled'\r\n                    ? 'bg-red-100 text-red-800'\r\n                    : order.status === 'completed'\r\n                    ? 'bg-blue-100 text-blue-800'\r\n                    : order.status === 'preparing' || order.status === 'ready'\r\n                    ? 'bg-purple-100 text-purple-800'\r\n                    : 'bg-gray-100 text-gray-800'\r\n                  }`}>\r\n                    {order.status.charAt(0).toUpperCase() + order.status.slice(1)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <h3 className=\"text-xl font-semibold text-gray-800 mb-4\">\r\n              {paymentStatus === 'completed' ? 'Payment Successful!' : 'M-Pesa Payment'}\r\n            </h3>\r\n            \r\n            {paymentStatus !== 'completed' ? (\r\n              <>\r\n                {!paymentInitiated ? (\r\n                  <MpesaPaymentForm\r\n                    orderId={orderId}\r\n                    amount={parseFloat(order.total)}\r\n                    onPaymentSuccess={() => setPaymentInitiated(true)}\r\n                  />\r\n                ) : (\r\n                  <PaymentStatus status={paymentStatus} />\r\n                )}\r\n              </>\r\n            ) : (\r\n              <PaymentStatus status={paymentStatus} />\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CheckoutPage;","import { useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst usePaymentStatus = (orderId, initialStatus) => {\r\n  const [status, setStatus] = useState(initialStatus);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (!orderId || status === 'completed') return;\r\n\r\n    const interval = setInterval(async () => {\r\n      try {\r\n        const response = await axios.get(`/api/orders/${orderId}/`, {\r\n          headers: {\r\n            'Authorization': `Bearer ${localStorage.getItem('access_token')}`\r\n          }\r\n        });\r\n\r\n        const newStatus = response.data.payment_status;\r\n        setStatus(newStatus);\r\n\r\n        if (newStatus === 'completed' || newStatus === 'failed') {\r\n          clearInterval(interval);\r\n        }\r\n      } catch (err) {\r\n        setError('Error checking payment status');\r\n        clearInterval(interval);\r\n      }\r\n    }, 5000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [orderId, status]);\r\n\r\n  return { status, error };\r\n};\r\n\r\nexport default usePaymentStatus;"],"names":["_ref","orderId","amount","onPaymentSuccess","phone","setPhone","useState","loading","setLoading","error","setError","paymentInitiated","setPaymentInitiated","_jsxs","className","children","_jsx","parseFloat","toFixed","xmlns","viewBox","fill","fillRule","d","clipRule","onSubmit","async","e","preventDefault","formattedPhone","cleaned","replace","startsWith","substring","length","formatPhoneNumber","response","axios","post","order_id","headers","localStorage","getItem","data","success","err","_err$response","_err$response$data","console","htmlFor","id","type","value","onChange","target","placeholder","required","disabled","_Fragment","cx","cy","r","stroke","strokeWidth","status","statusMessages","pending","completed","failed","CheckoutPage","useParams","navigate","useNavigate","order","setOrder","paymentStatus","usePaymentStatus","payment_status","useEffect","get","fetchOrder","timer","setTimeout","state","message","clearTimeout","meal_name","quantity","total","charAt","toUpperCase","slice","PaymentStatus","MpesaPaymentForm","initialStatus","setStatus","interval","setInterval","newStatus","clearInterval"],"sourceRoot":""}