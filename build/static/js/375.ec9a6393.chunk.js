"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[375],{375:(e,s,t)=>{t.r(s),t.d(s,{default:()=>o});var a=t(43),r=t(721),l=t(213),n=t(579);const d=e=>{let{orderId:s,amount:t,onPaymentSuccess:r}=e;const[d,c]=(0,a.useState)(""),[i,o]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[u,h]=(0,a.useState)(!1);return(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 border border-gray-200",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"M-Pesa Payment"}),(0,n.jsxs)("div",{className:"mb-6 p-4 bg-orange-50 rounded-md border border-orange-100",children:[(0,n.jsxs)("p",{className:"text-lg font-medium text-orange-800",children:["Amount: ",(0,n.jsxs)("span",{className:"font-bold",children:["KSh ",parseFloat(t).toFixed(2)]})]}),(0,n.jsx)("p",{className:"text-sm text-orange-600 mt-1",children:"Please ensure your phone number is registered with M-Pesa."})]}),u?(0,n.jsxs)("div",{className:"text-center py-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("div",{className:"mx-auto w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mb-3",children:(0,n.jsx)("span",{className:"text-orange-500 text-2xl",children:"\ud83d\udcf1"})}),(0,n.jsx)("h4",{className:"text-lg font-medium text-gray-900",children:"Payment Initiated"})]}),(0,n.jsxs)("div",{className:"space-y-2 text-gray-600",children:[(0,n.jsxs)("p",{className:"flex items-center justify-center",children:[(0,n.jsx)("svg",{className:"h-5 w-5 text-orange-500 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"Check your phone for an M-Pesa prompt."]}),(0,n.jsxs)("p",{className:"flex items-center justify-center",children:[(0,n.jsx)("svg",{className:"h-5 w-5 text-orange-500 mr-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Enter your M-Pesa PIN to complete payment."]})]}),(0,n.jsx)("div",{className:"mt-4 text-sm text-gray-500 italic",children:"This page will update automatically once payment is confirmed."})]}):(0,n.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),o(!0),x(null);const a=(e=>{const s=e.replace(/\D/g,"");return s.startsWith("0")?"254"+s.substring(1):s.startsWith("7")&&9===s.length?"254"+s:s})(d);if(12!==a.length||!a.startsWith("2547"))return x("Please enter a valid Kenyan M-Pesa phone number (e.g., 0712345678)."),void o(!1);try{const e=await l.A.post("http://localhost:8000/api/mpesa-payment/",{order_id:s,phone:a,amount:t},{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});e.data.success?h(!0):x(e.data.error||"Payment initiation failed. Please try again.")}catch(c){var r,n;console.error("M-Pesa Payment Error:",c),x((null===(r=c.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.error)||"Failed to initiate payment. Please check your network and try again.")}finally{o(!1)}},className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"mpesa-phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"M-Pesa Phone Number"}),(0,n.jsx)("input",{id:"mpesa-phone",type:"tel",value:d,onChange:e=>c(e.target.value),placeholder:"e.g. 0712345678 or 254712345678",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500"}),(0,n.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Must be registered with M-Pesa."})]}),m&&(0,n.jsx)("div",{className:"rounded-md bg-red-50 p-4 border border-red-200",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsxs)("div",{className:"ml-3",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Payment Error"}),(0,n.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,n.jsx)("p",{children:m})})]})]})}),(0,n.jsx)("button",{type:"submit",disabled:i,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white "+(i?"bg-orange-400 cursor-not-allowed":"bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500"),children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Pay with M-Pesa"})]})]})},c=e=>{let{status:s,error:t}=e;const a={pending:"Waiting for payment confirmation...",completed:"Payment completed successfully!",failed:t||"Payment failed. Please try again."};return(0,n.jsxs)("div",{className:`payment-status ${{pending:"payment-status-pending",completed:"payment-status-completed",failed:"payment-status-failed"}[s]}`,children:[(0,n.jsx)("div",{className:"status-icon",children:"completed"===s?"\u2713":"failed"===s?"\u2717":"\u23f3"}),(0,n.jsx)("p",{children:a[s]})]})};var i=t(973);const o=()=>{const{orderId:e}=(0,r.g)(),s=(0,r.Zp)(),[t,o]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),[p,g]=(0,a.useState)(!1),{status:y}=(0,i.A)(e,(null===t||void 0===t?void 0:t.payment_status)||"pending");return(0,a.useEffect)(()=>{e?(async()=>{try{const s=await l.A.get(`http://localhost:8000/api/orders/${e}/`);o(s.data)}catch(s){console.error("Error fetching order:",s),h("Failed to load order details. Please try again.")}finally{x(!1)}})():(h("Invalid order ID."),x(!1))},[e]),(0,a.useEffect)(()=>{if("completed"===y){const e=setTimeout(()=>{s("/customer-dashboard",{state:{message:"Payment completed successfully!"}})},3e3);return()=>clearTimeout(e)}},[y,s]),m?(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,n.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,n.jsx)("div",{className:"text-lg text-gray-600",children:"Loading order details..."})})}):u?(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,n.jsx)("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 rounded",children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)("svg",{className:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,n.jsx)("div",{className:"ml-3",children:(0,n.jsx)("p",{className:"text-sm text-red-700",children:u})})]})})}):t?(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Complete Your Payment"}),(0,n.jsx)("p",{className:"mt-2 text-gray-600",children:"Securely pay for your order using M-Pesa."})]}),(0,n.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden max-w-3xl mx-auto",children:(0,n.jsxs)("div",{className:"p-6 sm:p-8",children:[(0,n.jsxs)("div",{className:"mb-8 pb-6 border-b border-gray-200",children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Order Summary"}),(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"text-lg font-medium text-gray-900",children:["Order #",t.id]}),(0,n.jsxs)("p",{className:"text-gray-600",children:["Meal: ",t.meal_name]}),(0,n.jsxs)("p",{className:"text-gray-600",children:["Quantity: ",t.quantity]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:["KSh ",parseFloat(t.total).toFixed(2)]}),(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("confirmed"===t.status?"bg-green-100 text-green-800":"pending"===t.status?"bg-yellow-100 text-yellow-800":"cancelled"===t.status?"bg-red-100 text-red-800":"completed"===t.status?"bg-blue-100 text-blue-800":"preparing"===t.status||"ready"===t.status?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"completed"===y?"Payment Successful!":"M-Pesa Payment"}),"completed"!==y?(0,n.jsx)(n.Fragment,{children:p?(0,n.jsx)(c,{status:y}):(0,n.jsx)(d,{orderId:e,amount:parseFloat(t.total),onPaymentSuccess:()=>g(!0)})}):(0,n.jsx)(c,{status:y})]})]})})]}):(0,n.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:(0,n.jsx)("span",{className:"text-gray-400 text-2xl",children:"\u2753"})}),(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Order Not Found"}),(0,n.jsx)("p",{className:"text-gray-500",children:"We couldn't find the order details."})]})})}},973:(e,s,t)=>{t.d(s,{A:()=>l});var a=t(43),r=t(213);const l=(e,s)=>{const[t,l]=(0,a.useState)(s),[n,d]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!e||"completed"===t)return;const s=setInterval(async()=>{try{const t=(await r.A.get(`/api/orders/${e}/`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).data.payment_status;l(t),"completed"!==t&&"failed"!==t||clearInterval(s)}catch(t){d("Error checking payment status"),clearInterval(s)}},5e3);return()=>clearInterval(s)},[e,t]),{status:t,error:n}}}}]);
//# sourceMappingURL=375.ec9a6393.chunk.js.map