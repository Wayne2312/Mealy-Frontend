"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[87],{87:(e,t,o)=>{o.r(t),o.d(t,{AuthProvider:()=>u,default:()=>c,useAuth:()=>i});var r=o(43),a=o(213),s=o(579);const n="http://localhost:8000/api";a.A.defaults.withCredentials=!0;const l=(0,r.createContext)(),u=e=>{let{children:t}=e;const[o,u]=(0,r.useState)(null),[i,c]=(0,r.useState)(localStorage.getItem("token")),[d,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{i?(a.A.defaults.headers.common.Authorization=`Bearer ${i}`,m()):(u(null),delete a.A.defaults.headers.common.Authorization)},[i]);const m=async()=>{try{const e=await a.A.get(`${n}/auth/me/`);u(e.data)}catch(e){console.error("Error fetching user:",e),f()}},f=()=>{localStorage.removeItem("token"),c(null),u(null),delete a.A.defaults.headers.common.Authorization};return(0,s.jsx)(l.Provider,{value:{user:o,login:async(e,t)=>{h(!0);try{const o=await a.A.post(`${n}/auth/login/`,{email:e,password:t}),{access_token:r,user:s}=o.data;return localStorage.setItem("token",r),c(r),u(s),a.A.defaults.headers.common.Authorization=`Bearer ${r}`,{success:!0}}catch(l){var o,r,s;return console.error("Login error:",(null===(o=l.response)||void 0===o?void 0:o.data)||l.message),{success:!1,error:(null===(r=l.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.detail)||"Login failed"}}finally{h(!1)}},register:async function(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"customer";h(!0);try{const s=await a.A.post(`${n}/auth/register/`,{email:e,password:t,name:o,role:r}),{access_token:l,user:i}=s.data;return localStorage.setItem("token",l),c(l),u(i),a.A.defaults.headers.common.Authorization=`Bearer ${l}`,{success:!0}}catch(d){var s,l,i;return console.error("Registration error:",(null===(s=d.response)||void 0===s?void 0:s.data)||d.message),{success:!1,error:(null===(l=d.response)||void 0===l||null===(i=l.data)||void 0===i?void 0:i.detail)||"Registration failed"}}finally{h(!1)}},logout:f,loading:d},children:t})},i=()=>{const e=(0,r.useContext)(l);if(!e)throw new Error("useAuth must be used within AuthProvider");return e},c=u}}]);
//# sourceMappingURL=87.41efe6fc.chunk.js.map